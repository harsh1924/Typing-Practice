<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <!-- <script src="script.js" async></script> -->
    <title>Speed Typing</title>
</head>

<body>
    <h1>Speed Typing</h1>
    <!-- <div class="timer" id="timer">0</div> -->
    <div class="container">
        <div class="quote-display" id="quoteDisplay">
            Fetching Quote...
        </div>
        <textarea id="quoteInput" class="quoteInput" autofocus placeholder="Write Here...">quote</textarea>
    </div>
    <footer>
        Spaces are also considered during matching of the sentence.
    </footer>
</body>
<script>
    const RANDOM_QUOTE_API_URL = 'http://api.quotable.io/random';
    const quoteDisplayElement = document.getElementById('quoteDisplay');
    const quoteInputElement = document.getElementById('quoteInput');
    const timerElement = document.getElementById('timer');

    renderNextQuote();

    quoteInputElement.addEventListener('input', () => {
        const arrayQuote = quoteDisplayElement.querySelectorAll('span');
        const arrayValue = quoteInputElement.value.split('');
        const correct = true;

        arrayQuote.forEach((characterSpan, index) => {
            const character = arrayValue[index];
            if (character == null) {
                characterSpan.classList.remove('correct');
                characterSpan.classList.remove('incorrect');
                correct = false;
            } else if (character === characterSpan.innerText) {
                characterSpan.classList.add('correct');
                characterSpan.classList.remove('incorrect');
            } else {
                characterSpan.classList.remove('correct');
                characterSpan.classList.add('incorrect');
            }
        })

        if (correct) renderNextQuote();
    })

    async function getRandomQuote() {
        return await fetch('http://api.quotable.io/random').then(res => res.json()).then(data => data.content);
    }

    async function renderNextQuote() {
        const quote = await getRandomQuote();
        quoteDisplayElement.innerHTML = '';
        quote.split('').forEach(element => {
            const characterSpan = document.createElement('span');
            characterSpan.innerText = element;
            quoteDisplayElement.appendChild(characterSpan);
        });
        quoteInputElement.value = null;
        startTimer();
    }

    let startTime;
    function startTimer() {
        timerElement.innerText = 0;
        startTime = new Date();
        setInterval(() => {
            timer.innerText = getTimerTime();
        }, 1000);
    }

    function getTimerTime() {
        return Math.floor((new Date() - startTime) / 1000);
    }

    
</script>

</html>